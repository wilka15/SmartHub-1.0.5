<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SmartHub AI v1.0.5</title>
  <style>
    :root {
      --bg-light: #f3f3f3;
      --text-light: #111;
      --bg-dark: #0b0f19;
      --text-dark: #eef;

      /* –≠—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –∫–∞–∫ —Ç–µ–∫—É—â–∏–µ —Ü–≤–µ—Ç–∞ */
      --bg: var(--bg-dark);
      --text: var(--text-dark);
    }

    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      transition: background 0.3s, color 0.3s;
    }

    body.light {
      --bg: var(--bg-light);
      --text: var(--text-light);
    }

    .layout {
      display: flex;
      height: 100vh;
    }

    .chat-panel {
      flex: 3;
      padding: 20px;
      display: flex;
      flex-direction: column;
    }

    .header {
      text-align: center;
      margin-top: 0;
      font-weight: 700;
      font-size: 20px;
      color: #00d4ff;
    }

    #chat {
      background: rgba(255,255,255,0.05);
      border-radius: 10px;
      padding: 12px;
      flex: 1;
      overflow-y: auto;
    }

    .input-row {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .input-row input {
      flex: 1;
      padding: 12px;
      border-radius: 10px;
      border: none;
      font-size: 16px;
      background: rgba(0,0,0,0.2);
      color: inherit;
    }

    .icon-btn {
      width: 48px;
      height: 48px;
      border-radius: 10px;
      border: none;
      background: #00d4ff;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      font-weight: 700;
    }

    .small-btn {
      width: 44px;
      height: 44px;
      border-radius: 10px;
      border: none;
      background: #222;
      color: #ddd;
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .settings {
      flex: 1;
      padding: 18px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      background: rgba(255,255,255,0.07);
    }

    .settings h3 {
      margin: 0;
      color: #00d4ff;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 8px;
      font-size: 14px;
    }

    .switch-label {
      margin-bottom: 4px;
    }

    .footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-top: 6px;
      font-size: 13px;
      opacity: .85;
    }

    .version {
      margin-left: auto;
    }
  </style>
</head>
<body>
  <div class="layout">
    <div class="chat-panel">
      <div class="header">SmartHub AI</div>
      <div id="chat"></div>
      <div class="input-row">
        <input id="userInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." />
        <button class="icon-btn" id="sendBtn">‚û§</button>
        <button class="small-btn" id="micBtn">üé§</button>
        <button class="small-btn" id="speakBtn">üîä</button>
      </div>
      <div class="footer">
        <div class="version">SmartHub AI v1.0.5</div>
      </div>
    </div>

    <aside class="settings" id="settingsPanel">
      <h3>‚öô –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
      <div class="field">
        <label class="switch-label">–¢–µ–º–∞</label>
        <button id="themeToggleBtn">–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É</button>
      </div>
      <!-- —Ç—É—Ç –º–æ–≥—É—Ç –±—ã—Ç—å –¥—Ä—É–≥–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ -->
    </aside>
  </div>

  <script>
    // --- –¢–µ–º–∞ ---
    function applyTheme(theme) {
      if (theme === "light") {
        document.body.classList.add("light");
      } else {
        document.body.classList.remove("light");
      }
    }

    function saveTheme(theme) {
      localStorage.setItem("theme", theme);
    }

    function toggleTheme() {
      const current = localStorage.getItem("theme") === "light" ? "light" : "dark";
      const next = current === "light" ? "dark" : "light";
      applyTheme(next);
      saveTheme(next);
    }

    // –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ‚Äî –ø—Ä–∏–º–µ–Ω—è–µ–º —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—É—é —Ç–µ–º—É
    document.addEventListener("DOMContentLoaded", () => {
      const saved = localStorage.getItem("theme");
      if (saved) {
        applyTheme(saved);
      } else {
        // –º–æ–∂–Ω–æ —Ç–∞–∫–∂–µ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–∏—Å—Ç–µ–º–Ω—É—é —Ç–µ–º—É
        const preferDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
        applyTheme(preferDark ? "dark" : "light");
        saveTheme(preferDark ? "dark" : "light");
      }

      document.getElementById("themeToggleBtn").addEventListener("click", toggleTheme);
    });

    // --- –û—Å—Ç–∞–ª—å–Ω–æ–π JS: —á–∞—Ç –∏ —Ç.–¥. ---
    const API_URL = "https://openai-proxy-3.onrender.com/v1/responses";

    let lastAI = "";

    async function sendMessage() {
      const input = document.getElementById("userInput");
      const text = input.value.trim();
      if (!text) return;
      addMessage(text, "user");
      input.value = "";
      try {
        const resp = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ model: "gpt-4o-mini", input: text })
        });
        const data = await resp.json();
        let ai = "";
        if (data.choices?.[0]?.message?.content) {
          ai = data.choices[0].message.content;
        } else if (data.output?.[0]?.content) {
          ai = data.output[0].content[0]?.text || "";
        } else {
          ai = "–û—à–∏–±–∫–∞: —Å–µ—Ä–≤–µ—Ä –≤–µ—Ä–Ω—É–ª –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç.";
        }
        addMessage(ai, "ai");
        lastAI = ai;
      } catch (e) {
        addMessage("–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º", "ai");
        console.error(e);
      }
    }

    function addMessage(text, role) {
      const chat = document.getElementById("chat");
      const div = document.createElement("div");
      div.className = "msg " + role;
      div.textContent = text;
      chat.appendChild(div);
      chat.scrollTop = chat.scrollHeight;
    }

    document.getElementById("sendBtn").addEventListener("click", sendMessage);
    document.getElementById("userInput").addEventListener("keydown", e => { 
      if (e.key === "Enter") sendMessage(); 
    });

    // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–¥ voiceInput –∏ speakLast, –∫–∞–∫ —É —Ç–µ–±—è –±—ã–ª —Ä–∞–Ω—å—à–µ
  </script>
</body>
</html>
